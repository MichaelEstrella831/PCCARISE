<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Complaint and Issue Management</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: linear-gradient(to right, #d82c2c, #f27575);
    display: flex;
    color: #fff;
    min-height: 100vh;
  }
  .sidebar {
    background: #bb1e1e;
    width: 220px;
    padding: 20px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .logo {
    margin-bottom: 25px;
    text-align: center;
  }
  .logo img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
  }
  .logo span {
    font-weight: bold;
    font-size: 24px;
    margin-left: 10px;
    vertical-align: middle;
  }
  .nav-btn {
    background: #fff;
    color: #000;
    border-radius: 30px;
    width: 180px;
    padding: 10px 15px;
    margin: 8px 0;
    cursor: pointer;
    text-align: left;
    font-size: 16px;
    display: flex;
    align-items: center;
    transition: background 0.3s, color 0.3s;
    border: none;
  }
  .nav-btn.active {
    background: #00142c;
    color: #fff;
  }
  .nav-btn i {
    margin-right: 10px;
  }
  .main-content {
    flex: 1;
    padding: 30px;
    background: #f27575;
    color: #000;
    font-weight: bold;
  }
  .search-box {
    margin-bottom: 20px;
    text-align: center;
  }
  .search-box input {
    width: 350px;
    padding: 12px 15px;
    border-radius: 40px;
    border: none;
    outline: none;
    font-size: 16px;
  }
  .search-box button {
    background: transparent;
    border: none;
    cursor: pointer;
    position: relative;
    left: -40px;
  }
  .search-box button i {
    font-size: 18px;
    color: #555;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: #f8c9c9;
    border-radius: 15px;
    overflow: hidden;
  }
  thead tr {
    background: #223147;
    color: #fff;
    text-align: left;
  }
  thead th, tbody td {
    padding: 12px 15px;
  }
  tbody tr:nth-child(odd) {
    background: #f5b1b1;
  }
  tbody tr:nth-child(even) {
    background: #f8c9c9;
  }
  .update-btn, .feedback-btn {
    background: #990000;
    color: #fff;
    border-radius: 20px;
    border: none;
    padding: 6px 12px;
    cursor: pointer;
    font-weight: normal;
    transition: background 0.3s;
  }
  .update-btn:hover, .feedback-btn:hover {
    background: #cc0000;
  }
  .update-btn {
    background: linear-gradient(to bottom, #990000, #660000);
  }
  .update-btn:hover {
    background: linear-gradient(to bottom, #cc0000, #990000);
  }
  .feedback-btn {
    background: linear-gradient(to bottom, #004d99, #003366);
  }
  .feedback-btn:hover {
    background: linear-gradient(to bottom, #0066cc, #004080);
  }
  .status {
    font-weight: 700;
    padding: 5px 12px;
    border-radius: 20px;
    color: white;
    text-align: center;
    width: 110px;
  }
  .status.ongoing {
    background-color: #d32f2f;
  }
  .status.resolved {
    background-color: #388e3c;
  }
</style>
</head>
<body>

<div class="sidebar">
  <div class="logo">
    <img src="https://i.postimg.cc/jj0Vypft/arise-logo.png" alt="PCC ARISE Logo" />
    <span>ARISE</span>
  </div>
  <button class="nav-btn" onclick="location.href='tracking.html'">üó® Report Tracking</button>
  <button class="nav-btn active">üí¨ Complaint Management</button>
</div>

<div class="main-content">
  <h2>Recent Reports</h2>
  <div class="search-box">
    <input id="searchInput" type="search" placeholder="Search Here" aria-label="Search complaints" oninput="searchTable()" />
    <button aria-label="Search"><span>üîç</span></button>
  </div>
  <table aria-label="Recent complaint reports" id="complaintTable">
    <thead>
      <tr>
        <th>Student ID</th>
        <th>Type of Complaint</th>
        <th>Program</th>
        <th>Time</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
  let complaints = [];

  const tableBody = document.getElementById('tableBody');

  function formatTime(date) {
    let hours = date.getHours();
    let minutes = date.getMinutes();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12 || 12;
    return `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')} ${ampm}`;
  }

  function renderTable(data) {
    tableBody.innerHTML = '';
    if (data.length === 0) {
      const tr = document.createElement('tr');
      tr.innerHTML = '<td colspan="6" style="text-align:center; font-style: italic; color: #990000;">No reports yet</td>';
      tableBody.appendChild(tr);
      return;
    }

    data.forEach((comp, idx) => {
      const statusClass = comp.status.toLowerCase() === 'resolved' ? 'resolved' : 'ongoing';
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${comp.id}</td>
        <td>${comp.type}</td>
        <td>${comp.program}</td>
        <td>${comp.time}</td>
        <td><span class="status ${statusClass}">${comp.status}</span></td>
        <td>
          <button class="update-btn" onclick="updateStatus(${idx})">Update Status</button>
          <button class="feedback-btn" onclick="giveFeedback(${idx})">Give Feedback</button>
          <button class="update-btn" onclick="editComplaint(${idx})">Edit</button>
          <button class="feedback-btn" onclick="deleteComplaint(${idx})">Delete</button>
        </td>
      `;
      tableBody.appendChild(tr);
    });
  }

  function searchTable() {
    const filter = document.getElementById('searchInput').value.trim().toLowerCase();
    const filtered = complaints.filter(c =>
      c.id.toLowerCase().includes(filter) ||
      c.type.toLowerCase().includes(filter) ||
      c.program.toLowerCase().includes(filter) ||
      c.status.toLowerCase().includes(filter) ||
      c.time.toLowerCase().includes(filter)
    );
    renderTable(filtered);
  }

  function updateStatus(index) {
    const complaint = complaints[index];
    const newStatus = prompt(
      `Update status for Student ID: ${complaint.id}\nCurrent status: ${complaint.status}\nEnter "Ongoing" or "Resolved":`,
      complaint.status
    );

    if (!newStatus) return;

    const normalized = newStatus.trim().toLowerCase();
    if (normalized !== 'ongoing' && normalized !== 'resolved') {
      alert('Invalid status.');
      return;
    }

    complaints[index].status = normalized.charAt(0).toUpperCase() + normalized.slice(1);
    localStorage.setItem('complaints', JSON.stringify(complaints));
    searchTable();
    alert(`Status updated to "${complaints[index].status}"`);
  }

  function giveFeedback(index) {
    const complaint = complaints[index];
    const feedback = prompt(
      `Provide feedback for Student ID: ${complaint.id}\nExisting:\n${complaint.feedback || ''}\n\nEnter feedback:`
    );

    if (feedback !== null) {
      complaints[index].feedback = feedback.trim();
      localStorage.setItem('complaints', JSON.stringify(complaints));
      alert('Feedback saved.');
    }
  }

  
  function editComplaint(index) {
    const comp = complaints[index];

    const newId = prompt("Edit Student ID:", comp.id);
    if (newId === null) return;

    const newType = prompt("Edit Type of Complaint(Academic, Facility, Misconduct, Technical):", comp.type);
    if (newType === null) return;

    const newProgram = prompt("Edit Program(BSIT, BSA, BSED, BSP, BSBA, BSCOMM):", comp.program);
    if (newProgram === null) return;

    complaints[index].id = newId.trim();
    complaints[index].type = newType.trim();
    complaints[index].program = newProgram.trim();

    localStorage.setItem("complaints", JSON.stringify(complaints));
    searchTable();

    alert("Complaint updated successfully.");
  }


  function deleteComplaint(index) {
    const comp = complaints[index];
    const confirmDelete = confirm(
      `Are you sure you want to delete the complaint from Student ID: ${comp.id}?`
    );

    if (!confirmDelete) return;

    complaints.splice(index, 1);
    localStorage.setItem("complaints", JSON.stringify(complaints));
    searchTable();

    alert("Complaint deleted successfully.");
  }

  window.addEventListener('message', (event) => {
    const newComplaint = event.data;
    if (newComplaint && newComplaint.id) {
      if (!newComplaint.status) newComplaint.status = 'Ongoing';
      if (!('feedback' in newComplaint)) newComplaint.feedback = '';

      complaints.unshift(newComplaint);
      localStorage.setItem('complaints', JSON.stringify(complaints));
      searchTable();
    }
  });

  window.onload = () => {
    complaints = JSON.parse(localStorage.getItem('complaints')) || [];
    renderTable(complaints);
  };
</script>

</body>
</html>
